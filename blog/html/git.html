<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <title>Kosmos Blog</title>
        <link rel="stylesheet" href="/css/styles.css" type="text/css" title="no title" charset="utf-8">
        <link rel="stylesheet" href="/css/blog_styles.css" type="text/css" title="no title" charset="utf-8">
        <script charset="utf-8" src="/js/toc.js"></script>
        <link rel="shortcut icon" type="image/png" href="/image/favicon.png">
        <script src="/js/mathjax.js" async=""></script>
        <script charset="utf-8" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js">
        </script>
    </head>
    <body>
        <div id="blog_toc">
            <span id="blog_toc_header"></span>
            <script charset="utf-8">
                display_blog_toc_header();
            </script>
            <span id="blog_toc_content"></span>
            <script charset="utf-8">
                display_blog_toc_content();
            </script>
        </div>
        <div class="page" id="blog_page">
            <div class="blog_front"><p class="blog_title">版本管理工具git的使用</p><ul class="blog_annot"><li>Date: Sep. 23, 2018</li><li>Description: 这里主要是总结一下常用的git命令和使用方式</li></ul></div>
            <span id="blog_content"><h1 id="git-命令总结">git 命令总结</h1>
<h2 id="基本命令">基本命令</h2>
<pre><code class="shell language-shell">git init # 初始化git仓库
git add &lt;file&gt; # 将文件添加到暂存区
git commit -m "comments" # 将文件提交到版本库，并且添加comments
git status # 查看现在的git状态
git log # 查看git版本库提交历史</code></pre>
<h2 id="撤销命令">撤销命令</h2>
<pre><code class="shell language-shell">git checkout -- &lt;file&gt; # 用暂存区文件刷新文件夹中的文件
git reset HEAD &lt;file&gt; # 用版本库文件刷新暂存区文件
git reset --hard &lt;id&gt; # 回退到校验和id对应的版本
git reset --head HEAD^ # 回退到HEAD指示的前一个版本</code></pre>
<h2 id="分支管理">分支管理</h2>
<pre><code class="shell language-shell">git branch &lt;nb&gt; # 创建新分支nb
git checkout &lt;nb&gt; # 切换到分支nb
git branch # 查看现存的版本
git merge &lt;nb&gt; # 在另外一个分支下将nb合并到该分支下
git branch -d &lt;nb&gt; # 将分支nb删除</code></pre>
<h2 id="远程仓库">远程仓库</h2>
<pre><code class="shell language-shell">ssh-keygen -t rsa -C "yourmail@yourmail.com" # 产生ssh私钥和公钥
git remote add origin git@github.com:yourname/yourrepo # 添加远程仓库到本地，并取别名origin
git push -u origin master # 将本地master提交到远程origin，只有第一次需要添加-u
git fetch origin # 将远程仓库拉取下来，到origin/master分支
git pull &lt;远程主机名&gt; &lt;远程分支名&gt;:&lt;本地分支名&gt; # 将远程仓库拉取下来，并且合并到本地分支</code></pre>
<h1 id="创建仓库，添加文件">创建仓库，添加文件</h1>
<ol>
<li>创建一个文件夹，并且初始化仓库</li>
</ol>
<pre><code class="shell language-shell">mkdir gittest
cd gittest
git init</code></pre>
<ol start="2">
<li>在gittest文件夹中创建一个新文件，并且将这个文件加入暂存区</li>
</ol>
<pre><code class="shell language-shell">echo hello git &gt; README
git add README</code></pre>
<ol start="3">
<li>提交这个版本的文件，并且添加注释</li>
</ol>
<pre><code class="shell language-shell">git commit -m "add the readme file"</code></pre>
<p>这时候返回结果</p>
<pre><code class="text language-text">[master (root-commit) 9e08aae] add the readme file
 Committer: Kai Wang &lt;wangk@KaideMacBook-Pro.local&gt;
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly:

    git config --global user.name "Your Name"
    git config --global user.email you@example.com

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 1 file changed, 1 insertion(+)
 create mode 100644 README</code></pre>
<p>其中<code>9e08aae</code>是检验和，是记录版本的唯一标识。到此为止，我们成功在版本库中添加了一个版本。之后，我们可以对文件进行修改，再添加新的版本，操作如下：</p>
<ol start="4">
<li>修改文件，查看状态，提交版本</li>
</ol>
<pre><code class="shell language-shell">echo and hello world &gt;&gt; README
git status</code></pre>
<p><code>git status</code>是查看现在的git状态，会得到如下显示</p>
<pre><code class="text language-text">On branch master
Changes not staged for commit:
  (use "git add &lt;file&gt;..." to update what will be committed)
  (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)

    modified:   README

no changes added to commit (use "git add" and/or "git commit -a")</code></pre>
<p>这时候状态告诉我们有一个文件被修改了，然后我们需要用<code>git add &lt;file&gt;</code>将文件添加到暂存区，或者用<code>git checkout -- &lt;file&gt;</code>将文件修改撤销。我们尝试一下添加文件到暂存区</p>
<pre><code class="shell language-shell">git add README
git status</code></pre>
<p>我们试着查看一下<code>add</code>之后的状态</p>
<pre><code class="text language-text">On branch master
Changes to be committed:
  (use "git reset HEAD &lt;file&gt;..." to unstage)

    modified:   README</code></pre>
<p>这时候提示文件已经提交到暂存区，我们通过<code>git reset HEAD &lt;file&gt;</code>来用版本库中<code>HEAD</code>指针指向的版本来替代暂存区的文件，但是修改的文件还在文件夹中，但是处于为添加到暂存区的状态。
我们提交这个修改再查看一下状态</p>
<pre><code class="shell language-shell">git commit -m "modify the readme"
git status</code></pre>
<p>这时候的结果是</p>
<pre><code class="text language-text">On branch master
nothing to commit, working tree clean</code></pre>
<p>显示一切正常。</p>
<p>我们添加文件到文本库分为两步：第一步使用<code>git add &lt;file&gt;</code>将文件添加到暂存区，第二部使用<code>git commit -m "some comments"</code>将文件添加到版本库。
<img src="/image/gittest-1.png" alt=""></p>
<p>并且我们可以使用<code>git status</code>来查看目前没有添加到暂存区的文件或者添加到暂存区但是没有提交到版本库的文件。除此之外，我们还可以使用<code>git log</code>来查看版本库历史，看到的记过是</p>
<pre><code class="text language-text">commit e0ac9aeb4ddf50418d18cafcb732b0d8af733564 (HEAD -&gt; master)
Author: Kai Wang &lt;wangk@KaideMacBook-Pro.local&gt;
Date:   Sun Sep 23 10:38:21 2018 +0800

    modify the readme

commit 6ba82de8a66b265c1d43bffdd684e2233545f210
Author: Kai Wang &lt;wangk@KaideMacBook-Pro.local&gt;
Date:   Sun Sep 23 10:27:33 2018 +0800

    add the readme file</code></pre>
<p>为了让结果更清晰，我们可以对log格式进行一些配置，我们在<code>~/.gitconfig</code>里面添加如下命令</p>
<pre><code class="shell language-shell">[alias]
    st = status
    co = checkout
    ci = commit
    br = branch
    last = log -1
    lg = log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit
    unstage = reset HEAD
[credential]
    helper = store</code></pre>
<p>这时候，使用<code>git lg</code>命令显示</p>
<pre><code class="text language-text">* e0ac9ae - (HEAD -&gt; master) modify the readme (30 minutes ago) &lt;angAet --hard HEAD^</code></pre>
<h1 id="配置服务器端同步本地代码">配置服务器端同步本地代码</h1>
<ol>
<li>进入服务器端git仓库所在目录，比如我要把/home/wangk/grouptools/pyscript设置成仓库</li>
</ol>
<pre><code class="shell language-shell">cd /home/wangk/grouptools/pyscript
git init</code></pre>
<p>让仓库接受代码提交</p>
<pre><code class="shell language-shell">git config receive.denyCurrentBranch ignore </code></pre>
<p>禁止强制推送(可选)</p>
<pre><code class="shell language-shell">git config --bool receive.denyNonFastForwards false</code></pre>
<p>这样，远程仓库的ssh地址就是
 <code>ssh://wangk@venus.phys.tsinghua.edu.cn:/home/wangk/grouptools/pyscript/.git</code></p>
<ol start="2">
<li>进入本地仓库地址，比如我的代码放在/Users/wangk/Documents/Project/9.GalaxyGroup/pyscript中</li>
</ol>
<pre><code class="shell language-shell">cd /Users/wangk/Documents/Project/9.GalaxyGroup/pyscript
git remote add server  ssh://wangk@venus.phys.tsinghua.edu.cn:/home/wangk/grouptools/pyscript/.git</code></pre>
<ol start="3">
<li>push代码到服务器
本地：</li>
</ol>
<pre><code class="shell language-shell">git push server master</code></pre>
<p>服务器端(每次push之后必须到服务器端执行这个命令才可以看到改变)：</p>
<pre><code class="shell language-shell">git reset —hard</code></pre>
<ol start="4">
<li>pull代码到本地</li>
</ol>
<pre><code class="shell language-shell">git pull &lt;远程主机名&gt; &lt;远程分支名&gt;:&lt;本地分支名&gt;
git fetch &lt;远程主机名&gt;/&lt;远程分支名&gt;
git merge &lt;远程主机名&gt;/&lt;远程分支名&gt;</code></pre>
<p>DME
git status</p>
<pre><code>这时候显示`README`尚未添加到暂存区中</code></pre>
<p>text
On branch master
Changes not staged for commit:
  (use "git add <file>…" to update what will be committed)
  (use "git checkout -- <file>…" to discard changes in working directory)</file></file></p>
<pre><code>modified:   README</code></pre>
<p>no changes added to commit (use "git add" and/or "git commit -a")</p>
<pre><code>## 版本库回退</code></pre>
<p>shell
echo hello guys &gt;&gt; README
git add README
git commit -m "hello guys"
git lg</p>
<pre><code>这时候，log显示</code></pre>
<p>text</p>
<ul>
<li>372efab - (HEAD -&gt; master) hello guys (2 seconds ago) <kai wang=""></kai></li>
<li>e0ac9ae - modify the readme (50 minutes ago) <kai wang=""></kai></li>
<li>6ba82de - add the readme file (60 minutes ago) <kai wang=""></kai></li>
</ul>
<pre><code>我们看到上一个版本的校验和是`e0ac9ae`，而我们想回退到这个版本，所以我们使用</code></pre>
<p>shell
git reset --hard e0ac9ae</p>
<pre><code>如果我们只是想回退到上一个版本，但是又不想去输入校验和，那么我们可以使用</code></pre>
<p>shell
git res&gt;</p>
<ul>
<li>6ba82de - add the readme file (41 minutes ago) <kai wang=""></kai></li>
</ul>
<pre><code>显示就简介了很多。


# 撤销修改，撤销暂存区添加，版本库回退

git一个重要的功能就是能够回退到以前的状态来实现备份功能。对于git而言，我们有三个层次的回退：

- 撤销修改：使用暂存区的文件刷新文件夹中的文件
- 撤销暂存区添加：使用版本库里面的文件来刷新暂存区文件
- 版本库回退：使用以前的版本来替代目前的版本

## 撤销修改</code></pre>
<p>shell
echo hello father &gt;&gt; README
cat README</p>
<pre><code>这时候显示</code></pre>
<p>text
hello git
and hello world
hello father</p>
<pre><code></code></pre>
<p>shell
git checkout -- README
cat README</p>
<pre><code>这时候显示</code></pre>
<p>text
hello git
and hello world</p>
<pre><code>这时候刚刚添加的`hello father`就被撤销了。**注意，这种撤销之后的就无法再恢复了。**

## 撤销暂存区添加</code></pre>
<p>shell
echo hello sun &gt;&gt; README
git add README
git status</p>
<pre><code>这时候显示我们已经添加了文件</code></pre>
<p>text
On branch master
Changes to be committed:
  (use "git reset HEAD <file>…" to unstage)</file></p>
<pre><code>modified:   README</code></pre>
<pre><code>这时候我们使用版本库里面`HEAD`指针指向的版本刷新暂存区文件。</code></pre>
<p>shell
git reset HEAD REKai W</p></span>
        </div>
    

</body>